<!DOCTYPE html>
<html lang="en-us">
  <head>
      <!--- CSS styles here -->
      <link rel="stylesheet" type="text/css" href="style.css">
      <script src="https://d3js.org/d3.v6.min.js"></script>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <header>
      <title>2024 Presidential Elections in Venezuela</title>
        <div id="bg-headline">
          <h1>2024 Presidential Elections in Venezuela</h1></div>
    </header>
    
    <div class="spacer"></div>
    <div id="chart"></div>
    <div class="tooltip"></div>



    <script>
        // Load data from CSV file
        d3.csv("PrimariesResultsNYC.csv").then(data => {
            // Extract candidate names and table data
            const candidates = data.map(d => d.Candidate.replace(/"/g, ''));
            const tableData = data.map(d => Object.values(d).slice(1).map(Number));

            // Determine the number of tables and candidates
            const numTables = tableData[0].length;
            const numCandidates = candidates.length;

            // Set the size of each cell and padding
            const cellSize = 30;
            const padding = 60; // Increased padding for left margin and x-axis labels

            // Calculate the dimensions of the SVG container
            const width = numTables * cellSize + padding;
            const height = numCandidates * cellSize + padding;

            // Define a color scale based on the number of votes for each candidate
            const colorScale = d3.scaleSequential(d3.interpolateOranges)
                .domain([0, d3.max(tableData.flat())]);

            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${padding}, ${padding / 2})`);

            const tooltip = d3.select(".tooltip");

            // Create the heatmap cells
            const cells = svg.selectAll(".cell")
                .data(tableData.flat())
                .enter()
                .append("rect")
                .attr("class", "cell")
                .attr("x", (d, i) => (i % numTables) * cellSize)
                .attr("y", (d, i) => Math.floor(i / numTables) * cellSize)
                .attr("width", cellSize)
                .attr("height", cellSize)
                .attr("fill", d => colorScale(d))
                .on("mouseover", (event, d, i) => {
                    const rowIndex = Math.floor(i / numTables);
                    const columnIndex = i % numTables;
                    const candidate = candidates[rowIndex];
                    const table = `Table ${columnIndex + 1}`;
                    const votesInTable = `Votes: ${tableData[rowIndex][columnIndex]}`;
                    const totalVotes = `Total: ${data[rowIndex][table]}`;
                    tooltip.style("display", "block");
                    tooltip.html(`${candidate}<br>${table}<br>${votesInTable} (${totalVotes})`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", () => {
                    tooltip.style("display", "none");
                });

            // Add x-axis labels (candidate names)
            svg.selectAll(".x-label")
                .data(candidates)
                .enter()
                .append("text")
                .attr("class", "x-label")
                .attr("x", -5)
                .attr("y", (d, i) => (i + 0.5) * cellSize)
                .style("text-anchor", "end")
                .attr("dy", "0.3em")
                .text(d => d);

            // Add y-axis labels (table numbers) with diagonal text
            svg.selectAll(".y-label")
                .data(d3.range(1, numTables + 1))
                .enter()
                .append("text")
                .attr("class", "y-label")
                .attr("x", (d, i) => (i + 0.5) * cellSize)
                .attr("y", -5)
                .style("text-anchor", "middle")
                .attr("transform", "rotate(-45)")  // Rotate the text by -45 degrees
                .text(d => `Table ${d}`);

        });
    </script>
    
    <div class="spacer"></div>
    
    <footer>
        Â© Copyright 2023. All Rights Reserved. | <a href="isabelbonnet.com" target="_blank" title="Isabel Bonnet">Isabel Bonnet</a>
    </footer>
  </body>
</html>
